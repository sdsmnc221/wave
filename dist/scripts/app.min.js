$(document).ready(function(){var e=["Chlore","OxyConcentration","Oxygene","pH","Pression","Salinite","TempeAir","TempeEau"],t={EN:["Chlorine","Saturation","Oxygene","pH","Pressure","Salinity","Air Temp.","Water Temp."],FR:["Chlore","Saturation","Oxygène","pH","Pression","Salinité","Temp. d'Air","Temp. d'Eau"],VI:["Clo","Độ bão hoà","Ôxy","pH","Áp suất","Nồng độ muối","Nhiệt độ không khí","Nhiệt độ nước"]},n="../scripts/api.php",a=3e4,r=t[$("html").attr("lang").trim().toUpperCase()];Barba.Pjax.init(),Barba.Prefetch.init(),Barba.Pjax.originalPreventCheck=Barba.Pjax.preventCheck,Barba.Pjax.preventCheck=function(e,t){return!!Barba.Pjax.originalPreventCheck(e,t)&&!(/vi/.test(t.href.toLowerCase())||/fr/.test(t.href.toLowerCase())||/en/.test(t.href.toLowerCase()))};var i=Barba.BaseTransition.extend({start:function(){Promise.all([this.newContainerLoading,this.fadeOut()]).then(this.fadeIn.bind(this))},fadeOut:function(){return $(this.oldContainer).animate({opacity:0}).promise()},fadeIn:function(){var e=this;url=window.location.href.slice(23),document.body.scrollTop=0,$(".nav-link-active").removeClass("nav-link-active"),$(".nav-link[href='"+url+"']").addClass("nav-link-active"),$(this.oldContainer).hide(),$(this.newContainer).css({visibility:"visible",opacity:0}),$(this.newContainer).animate({opacity:1},"slow",function(){e.done()})}}),o=function(){var e=window.location.href;return-1!==e.indexOf("en")?"en":-1!==e.indexOf("fr")?"fr":"vi"};function l(){$(".app .controller__refresh").on("click",function(e){d()})}function s(){$(".card__infobox--temp").each(function(e,t){var n=-1===window.location.href.indexOf("details.html")?$(t).find("h3").first().text().trim():$(".controller__stats .dropdown-item.active").text().trim();-1===n.indexOf("Temp")&&-1===n.indexOf("Nhiệt độ")||$(t).attr("title",-1!==n.indexOf("Temp")?"Conversion Celsius <-> Farenheit":"Đổi Celsius <-> Farenheit").css("cursor","pointer").on("click",function(e){var t=$(e.currentTarget).find("p").first(),n=parseFloat(t.text().trim());-1!==t.text().indexOf("°C")?t.html((1.8*n+32).toFixed(2)+"<span class='unit'>°F</span"):t.html(((n-32)/1.8).toFixed(2)+"<span class='unit'>°C</span")})})}function d(){if($(".alert").remove(),$(".dim").remove(),$(".content").children().removeClass("blurred"),-1!==window.location.href.indexOf("details.html")){var t=$(".controller__stats .dropdown-toggle").text().trim();$.ajax({url:n,dataType:"json",data:{read_all:e[r.findIndex(function(e){return e===t})]}}).done(function(e){var n=e[0].Valeurs.toFixed(2),a=o();graphName="en"===a?"<h2>"+t+"'s Graph</h2>":"fr"===a?"<h2>Graphe : "+t+"</h2>":"<h2>Biểu đồ "+t+"</h2>",$(".card--current .card__infobox p").html(-1!==t.indexOf("Temp")||-1!==t.indexOf("Nhiệt độ")?n+"<span class='unit'>°C</span":-1!==t.indexOf("Press")||-1!==t.indexOf("Áp suất")?n+"<span class='unit'>pHa</span":n),$(".card--current .card__infobox h3").text(t.toUpperCase()),$($(".card__graph").siblings()[0]).html(graphName),c()}).fail(function(e){f()})}else $.ajax({url:n,dataType:"json",data:{read_lo:!0}}).done(function(t){$(".card__infobox--temp").each(function(n,a){var i=$(a).find("h3").text().trim(),o=t.find(function(t){return t.type===e[r.findIndex(function(e){return e===i})]}).Valeurs.toFixed(2);$(a).find("p").html(-1!==i.indexOf("Temp")||-1!==i.indexOf("Nhiệt độ")?o+"<span class='unit'>°C</span":-1!==i.indexOf("Press")?o+"<span class='unit'>pHa</span":o),c()})}).fail(function(e){f()});setTimeout(function(){d()},a)}function c(){var t=$(".controller__stats .dropdown-toggle").text().trim();$("");$("canvas#graph").hide("slow").remove(),$(".card__graph").append('<canvas id="graph"></canvas>'),function(t){var a=o();$.ajax({url:n,dataType:"json",data:{read_all:e[r.findIndex(function(e){return e===t})]}}).done(function(e){-1===window.location.href.indexOf("details.html")?p(e.slice(0,7)):p(e);var n=-1===window.location.href.indexOf("details.html")?u(e,7):u(e,e.length),r=$("#graph"),i={type:"line",labels:n.map(function(e){return e.x}),data:{datasets:[{data:n,label:t,borderColor:"#03A9F4",fill:!1}]},options:{title:{display:!0,text:"en"===a?"Last 7 "+t+" stats":"fr"===a?t+" - Les 7 dernières valeurs":"7 giá trị cuối cùng của "+t},scales:{xAxes:[{type:"time",time:{parser:"MM/DD/YYYY HH:mm",unit:"day",tooltipFormat:"ll HH:mm"},scaleLabel:{display:!1,labelString:"Date"}}],yAxes:[{scaleLabel:{display:!1,labelString:"Value"},ticks:{stepSize:m(n.map(function(e){return e.y}).sort().reverse()[0])/10,min:0,max:m(n.map(function(e){return e.y}).sort().reverse()[0])}}]}}};return new Chart(r,i)})}(t)}function f(){var e,t=document.createElement("div"),n=document.createElement("div"),a=o();e="en"===a?"No data. Refresh the page or check database connection.":"fr"===a?"Aucune donnée. Rechargez la page ou vérifiez la connexion vers la BDD.":"Không có dữ liệu. Tải lại trang hoặc kiểm tra kết nối với CSDL.",$(".content").children().addClass("blurred"),$(n).addClass("dimmed").appendTo($(".content")),$(t).addClass("alert alert-danger").attr("role","alert").html(e).appendTo($(".content"))}function p(e){var t="";e.forEach(function(e,n){t+="<tr>\n                <th scope='row'> "+(-1!==window.location.href.indexOf("detail.html")?e.ID:n+1)+" </th>\n                <td> "+e.Valeurs+" </td>\n                <td> "+h(e.time)+" </td>\n            </tr>"}),$("#table tbody").html(t),$("#table").parent().scrollTop(0)}function u(e,t){return e.slice(0,t).map(function(e){return{x:h(e.time),y:e.Valeurs}})}function h(e){return moment(e,"YYYY/MM/DD HH:mm").toDate()}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Math.ceil(e/t)*t}Barba.Pjax.getTransition=function(){return i},Barba.Dispatcher.on("initStateChange",function(){var e=window.location.href;r=-1!==e.indexOf("en")?t.EN:-1!==e.indexOf("fr")?t.FR:t.VI}),Barba.Dispatcher.on("transitionCompleted",function(){o(),l(),c(),-1===window.location.href.indexOf("contact.html")&&-1===window.location.href.indexOf("about.html")&&d()}),$(".app").on("click",".menu .controller__sidebar",function(){$(".menu").css("transform","translateX(-110%)").removeClass("col-12 col-md-3 col-lg-2"),$("#barba-wrapper").removeClass("col-md-9 col-lg-10"),$(".header nav").css("margin-left","65px"),$(".header .controller__sidebar").removeClass("invisible")}),$(".app").on("click",".header .controller__sidebar",function(){$(".menu").addClass("col-12 col-md-3 col-lg-2").css("transform","translateX(0%)"),$("#barba-wrapper").addClass("col-md-9 col-lg-10"),$(".header nav").css("margin-left","0"),$(".header .controller__sidebar").addClass("invisible")}),$(".dropdown-toggle").dropdown(),l(),s(),-1===window.location.href.indexOf("contact.html")&&-1===window.location.href.indexOf("about.html")&&d(),$(".app").on("click",".controller__stats button.dropdown-item",function(){var e=$(this).text().trim();$(".controller__stats .dropdown-toggle").text(e),$(".controller__stats .dropdown-menu .dropdown-item").each(function(t,n){$(n).removeClass("active"),$(n).text()===e&&$(n).addClass("active")}),c(),-1!==window.location.href.indexOf("details.html")&&(d(),-1!==e.indexOf("Temp")||-1!==e.indexOf("Nhiệt độ")?($(".card--current-value").addClass("card__infobox--temp"),s()):$(".card__infobox--temp").each(function(e,t){$(t).removeAttr("type").css("cursor","default").off("click").removeClass("card__infobox--temp")}))}),c()});